<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enneagram Assessment | BGB Group</title>
    <meta name="description" content="A professional, standalone Enneagram personality assessment.">
    <style>
        /* --- BRAND PALETTE --- */
        :root {
            --primary: #36069A;       /* Purple */
            --secondary: #DE6399;     /* Pink */
            --dark: #020C28;          /* Navy */
            --accent: #4ADEDE;        /* Teal */
            --neutral-light: #F8F9FA;
            --neutral-dark: #212529;
            --neutral-mid: #6C757D;
            --white: #FFFFFF;
            --shadow: 0 8px 32px rgba(2, 12, 40, 0.15);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--dark);
            background-image: linear-gradient(135deg, var(--dark) 0%, #1a0b3b 100%);
            color: var(--neutral-dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* --- LAYOUT --- */
        .app-container {
            background: var(--white);
            width: 100%;
            max-width: 700px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER --- */
        header {
            background: var(--primary);
            color: var(--white);
            padding: 24px 32px;
            position: relative;
        }

        h1 { font-size: 1.5rem; font-weight: 700; margin-bottom: 4px; }
        .subtitle { opacity: 0.9; font-size: 0.9rem; font-weight: 300; }

        /* --- PROGRESS BAR --- */
        .progress-container {
            height: 6px;
            background: #E9ECEF;
            width: 100%;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--secondary));
            width: 0%;
            transition: width 0.4s ease;
        }

        /* --- CONTENT AREAS --- */
        .view-section {
            padding: 32px;
            flex: 1;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.4s ease-out;
        }

        .hidden { display: none !important; }

        /* --- INTRO VIEW --- */
        .intro-content {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
            gap: 24px;
        }

        .intro-icon {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 16px;
        }

        /* --- QUIZ VIEW --- */
        .question-meta {
            display: flex;
            justify-content: space-between;
            color: var(--neutral-mid);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 32px;
            text-align: center;
            line-height: 1.3;
        }

        /* --- RATING SCALE UX --- */
        .likert-scale {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: auto;
            margin-bottom: 24px;
        }

        .likert-btn {
            background: var(--white);
            border: 2px solid #E9ECEF;
            border-radius: 8px;
            padding: 12px 4px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            height: 80px;
            color: var(--neutral-mid);
        }

        .likert-btn:hover {
            border-color: var(--primary);
            background: #F8F9FF;
            transform: translateY(-2px);
        }

        .likert-btn:focus-visible {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(74, 222, 222, 0.4);
        }

        .likert-value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .likert-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 600;
            text-align: center;
        }

        /* Visual scaling for likert buttons */
        .likert-btn:nth-child(1) .likert-value { font-size: 1rem; opacity: 0.6; }
        .likert-btn:nth-child(2) .likert-value { font-size: 1.1rem; opacity: 0.7; }
        .likert-btn:nth-child(3) .likert-value { font-size: 1.2rem; opacity: 0.8; }
        .likert-btn:nth-child(4) .likert-value { font-size: 1.3rem; opacity: 0.9; }
        .likert-btn:nth-child(5) .likert-value { font-size: 1.5rem; color: var(--secondary); }

        .nav-controls {
            display: flex;
            justify-content: center;
            padding-top: 16px;
        }

        /* --- RESULTS VIEW --- */
        .results-header {
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid #E9ECEF;
        }

        .type-badge {
            display: inline-block;
            background: var(--dark);
            color: var(--accent);
            padding: 8px 16px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 16px;
        }

        .result-title {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .data-viz {
            margin: 24px 0;
            background: var(--neutral-light);
            padding: 20px;
            border-radius: 8px;
        }

        .chart-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .chart-label { width: 30px; font-weight: bold; color: var(--neutral-mid); }
        .chart-bar-container { flex: 1; height: 12px; background: #E9ECEF; border-radius: 6px; overflow: hidden; margin: 0 10px; }
        .chart-bar { height: 100%; background: var(--primary); border-radius: 6px; width: 0; transition: width 1s ease-out; }
        .chart-bar.top-result { background: var(--secondary); }
        
        .details-grid {
            display: grid;
            gap: 24px;
        }

        .detail-card {
            background: var(--neutral-light);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
        }

        .detail-card h3 { color: var(--dark); font-size: 1.1rem; margin-bottom: 12px; }
        .detail-card ul { padding-left: 20px; }
        .detail-card li { margin-bottom: 6px; color: #495057; }

        /* --- BUTTONS --- */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--secondary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: #c94b82;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(222, 99, 153, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--neutral-mid);
            color: var(--neutral-mid);
        }

        .btn-outline:hover {
            border-color: var(--dark);
            color: var(--dark);
        }
        
        .citation {
            font-size: 0.75rem;
            color: var(--neutral-mid);
            margin-top: 32px;
            text-align: center;
            padding: 12px;
            border-top: 1px solid #eee;
        }

        .citation a { color: var(--primary); text-decoration: none; }

        /* --- ANIMATIONS --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- MOBILE --- */
        @media (max-width: 600px) {
            .app-container { min-height: 100vh; border-radius: 0; }
            .view-section { padding: 20px; }
            .question-text { font-size: 1.25rem; }
            .likert-scale { gap: 4px; }
            .likert-label { font-size: 0.6rem; }
        }
    </style>
</head>
<body>

<div class="app-container" aria-live="polite">
    <header>
        <h1>Enneagram Assessment</h1>
        <div class="subtitle">BGB Group | Fact-Driven Discovery</div>
    </header>

    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- START SCREEN -->
    <div id="startScreen" class="view-section">
        <div class="intro-content">
            <div>
                <div class="intro-icon">★</div>
                <h2 style="color: var(--dark); margin-bottom: 12px;">Discover Your Core Type</h2>
                <p style="color: var(--neutral-mid); max-width: 500px; margin: 0 auto;">
                    This updated assessment uses a <strong>frequency scale</strong> to reduce bias. You will be presented with 27 statements. Rate how accurately each statement describes you.
                </p>
            </div>
            <ul style="text-align: left; max-width: 400px; margin: 0 auto; list-style: none; color: var(--neutral-dark);">
                <li style="margin-bottom: 10px;">✓ <strong>Accurate:</strong> Evaluates each type independently.</li>
                <li style="margin-bottom: 10px;">✓ <strong>Holistic:</strong> Analyzes motivations, not just behaviors.</li>
                <li style="margin-bottom: 10px;">✓ <strong>Secure:</strong> No data leaves this device.</li>
            </ul>
            <button class="btn btn-primary" onclick="quiz.start()" style="width: 100%; max-width: 300px; margin: 20px auto;">Begin Assessment</button>
        </div>
    </div>

    <!-- QUIZ SCREEN -->
    <div id="quizScreen" class="view-section hidden">
        <div class="question-meta">
            <span id="qCount">Statement 1 of 27</span>
            <button class="btn-outline" onclick="quiz.prev()" style="border:none; padding: 0; font-size: 0.85rem;">Back</button>
        </div>
        
        <h2 id="qText" class="question-text">Loading...</h2>
        
        <div class="likert-scale">
            <button class="likert-btn" onclick="quiz.rate(1)">
                <span class="likert-value">1</span>
                <span class="likert-label">Never</span>
            </button>
            <button class="likert-btn" onclick="quiz.rate(2)">
                <span class="likert-value">2</span>
                <span class="likert-label">Rarely</span>
            </button>
            <button class="likert-btn" onclick="quiz.rate(3)">
                <span class="likert-value">3</span>
                <span class="likert-label">Sometimes</span>
            </button>
            <button class="likert-btn" onclick="quiz.rate(4)">
                <span class="likert-value">4</span>
                <span class="likert-label">Often</span>
            </button>
            <button class="likert-btn" onclick="quiz.rate(5)">
                <span class="likert-value">5</span>
                <span class="likert-label">Always</span>
            </button>
        </div>
    </div>

    <!-- RESULTS SCREEN -->
    <div id="resultsScreen" class="view-section hidden">
        <!-- Injected by JS -->
    </div>
</div>

<script>
/**
 * REFACTORED DATA STRUCTURE
 * 27 Statements: 3 per type to ensure equal weight.
 * Shuffle implemented on init to prevent pattern recognition.
 */
const rawStatements = [
    // Type 1
    { text: "I have an internal critic that constantly tells me how I (and things around me) could be better.", type: 1 },
    { text: "I struggle to relax until I know everything is done correctly and effectively.", type: 1 },
    { text: "I feel a strong sense of responsibility to maintain high moral standards.", type: 1 },
    // Type 2
    { text: "I often prioritize the needs of others above my own, sometimes to my detriment.", type: 2 },
    { text: "It is important to me that people feel supported and appreciate my help.", type: 2 },
    { text: "I can be overly demonstrative with my affection to ensure connection.", type: 2 },
    // Type 3
    { text: "I am highly driven by goals and want to be recognized for my achievements.", type: 3 },
    { text: "I can easily adapt my persona to fit the expectations of a specific group or situation.", type: 3 },
    { text: "Efficiency is key; I hate wasting time on things that don't produce results.", type: 3 },
    // Type 4
    { text: "I often feel that something is missing in me that others seem to have.", type: 4 },
    { text: "I value being unique and authentic, even if it means being misunderstood.", type: 4 },
    { text: "My emotions are intense, and I often spend time exploring my internal world.", type: 4 },
    // Type 5
    { text: "I need a lot of private time to recharge and process information.", type: 5 },
    { text: "I prefer to observe and understand a situation fully before participating.", type: 5 },
    { text: "I often feel drained by others' emotional demands and withdraw to protect my energy.", type: 5 },
    // Type 6
    { text: "I am constantly scanning my environment for potential risks or problems.", type: 6 },
    { text: "Loyalty is crucial to me; I need to know who I can truly trust.", type: 6 },
    { text: "I often struggle with self-doubt and look to trusted authorities or systems for guidance.", type: 6 },
    // Type 7
    { text: "I love exploring new possibilities and have a hard time committing to just one option.", type: 7 },
    { text: "I try to keep my mood positive and avoid dwelling on painful or boring topics.", type: 7 },
    { text: "I am often planning my next adventure before the current one is even finished.", type: 7 },
    // Type 8
    { text: "I have a strong need to be in control of my own destiny and avoid being vulnerable.", type: 8 },
    { text: "I am direct and assertive; I don't mind conflict if it clears the air.", type: 8 },
    { text: "I naturally take charge of situations when leadership is lacking.", type: 8 },
    // Type 9
    { text: "I often go along with others to avoid conflict and keep the peace.", type: 9 },
    { text: "I can see all sides of an issue, which sometimes makes it hard to make a definitive decision.", type: 9 },
    { text: "I prefer a calm, stable environment and dislike feeling rushed or pressured.", type: 9 }
];

const typeDescriptions = {
  1: {
    name: "Type 1: The Reformer",
    altNames: "Moralizer, Perfectionist",
    description: "Ethical, orderly, and goal-oriented. You strive for integrity and improvement.",
    strengths: ["Dependable and conscientious", "Discerning with high standards", "Morally principled", "Detail-oriented"],
    challenges: ["Critical of self and others", "Perfectionistic tendencies", "Difficulty accepting imperfection"],
    motivations: "Clear instruction, ethical environments, and goal-setting.",
    atBest: "Wise, discerning, realistic, and morally heroic."
  },
  2: {
    name: "Type 2: The Helper",
    altNames: "Giver, Mentor",
    description: "Sincere, empathetic, and generous. You seek to love and be loved.",
    strengths: ["Unselfish and caring", "Adaptable and supportive", "Optimistic and warm", "Anticipates needs"],
    challenges: ["May use flattery as defense", "Possessive in relationships", "Neglects own needs"],
    motivations: "Appreciation, recognition, and encouraging environments.",
    atBest: "Genuinely caring, unselfish, and empowering to others."
  },
  3: {
    name: "Type 3: The Performer",
    altNames: "Achiever, Producer",
    description: "Charming, poised, and action-oriented. You focus on achievement and success.",
    strengths: ["Authentic when secure", "Inspiring and motivating", "Efficient and productive", "Determined"],
    challenges: ["Status-conscious", "Workaholic tendencies", "Disconnection from feelings"],
    motivations: "Success, recognition, and goal achievement.",
    atBest: "Authentic, inspiring, efficient, and balanced."
  },
  4: {
    name: "Type 4: The Dreamer",
    altNames: "Individualist, Romantic",
    description: "Artistic, innovative, and self-aware. You desire to express your unique identity.",
    strengths: ["Creative and original", "Emotionally honest", "Inspired", "Deeply empathetic"],
    challenges: ["Disdain for the ordinary", "Struggles with envy", "Moody and withdrawn"],
    motivations: "Authenticity, depth, and creative expression.",
    atBest: "Creative, inspired, and able to transform pain into beauty."
  },
  5: {
    name: "Type 5: The Observer",
    altNames: "Investigator, Thinker",
    description: "Insightful, curious, and perceptive. You value autonomy and competence.",
    strengths: ["Visionary thinking", "Novel perspectives", "Focused and analytical", "Objective"],
    challenges: ["Detached and isolated", "Overly cerebral", "Emotional guarding"],
    motivations: "Knowledge, competence, and privacy.",
    atBest: "Visionary, innovative, and able to see the big picture."
  },
  6: {
    name: "Type 6: The Loyalist",
    altNames: "Guardian, Team Player",
    description: "Reliable, trustworthy, and committed. You value security and support.",
    strengths: ["Courageous when secure", "Stable and committed", "Self-reliant", "Responsible"],
    challenges: ["Overly cautious", "Defensive", "Anxious", "Worst-case thinking"],
    motivations: "Security, trust, and organized environments.",
    atBest: "Courageous, stable, and trusting of self and others."
  },
  7: {
    name: "Type 7: The Enthusiast",
    altNames: "Visionary, Epicure",
    description: "Fun-loving, impulsive, and spontaneous. You seek variety and freedom.",
    strengths: ["Joyful and optimistic", "Appreciative", "Satisfied", "Energetic"],
    challenges: ["Commitment issues", "Overextended", "Avoids pain", "Scattered"],
    motivations: "Variety, freedom, and new experiences.",
    atBest: "Joyful, present, and satisfied."
  },
  8: {
    name: "Type 8: The Protector",
    altNames: "Boss, Challenger",
    description: "Authoritative, assertive, and powerful. You seek to protect yourself and others.",
    strengths: ["Strong and protective", "Justice-oriented", "Decisive", "Natural leader"],
    challenges: ["Aggressive", "Confrontational", "Excessive", "Intimidating"],
    motivations: "Power, autonomy, and impact.",
    atBest: "Strong, generous, and a champion for justice."
  },
  9: {
    name: "Type 9: The Peacemaker",
    altNames: "Mediator, Peacekeeper",
    description: "Passive, inclusive, and stable. You seek internal and external harmony.",
    strengths: ["Unifying", "Inclusive", "Calm and reassuring", "Patient"],
    challenges: ["Oversimplifies problems", "Avoids conflict", "Procrastinates"],
    motivations: "Harmony, peace, and stability.",
    atBest: "Peaceful, inclusive, and able to see all perspectives."
  }
};

/**
 * Quiz Logic Class
 */
class Quiz {
    constructor() {
        this.questions = [];
        this.currentQ = 0;
        this.scores = {}; // type -> total score
        
        // Initialize scores
        for(let i=1; i<=9; i++) this.scores[i] = 0;
        
        this.dom = {
            screens: {
                start: document.getElementById('startScreen'),
                quiz: document.getElementById('quizScreen'),
                results: document.getElementById('resultsScreen')
            },
            progress: document.getElementById('progressBar'),
            qText: document.getElementById('qText'),
            qCount: document.getElementById('qCount')
        };
    }

    shuffle(array) {
        // Fisher-Yates shuffle
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    start() {
        // Shuffle questions so types aren't clustered
        this.questions = this.shuffle([...rawStatements]);
        this.switchScreen('quiz');
        this.renderQuestion();
    }

    switchScreen(screenName) {
        Object.values(this.dom.screens).forEach(el => el.classList.add('hidden'));
        this.dom.screens[screenName].classList.remove('hidden');
    }

    renderQuestion() {
        const q = this.questions[this.currentQ];
        
        this.dom.qCount.textContent = `Statement ${this.currentQ + 1} of ${this.questions.length}`;
        this.dom.progress.style.width = `${((this.currentQ) / this.questions.length) * 100}%`;
        
        // Fade effect
        this.dom.qText.style.opacity = 0;
        setTimeout(() => {
            this.dom.qText.textContent = q.text;
            this.dom.qText.style.opacity = 1;
        }, 150);
    }

    rate(value) {
        // Add value to the specific type for this question
        const type = this.questions[this.currentQ].type;
        this.scores[type] += value;

        this.next();
    }

    next() {
        if (this.currentQ < this.questions.length - 1) {
            this.currentQ++;
            this.renderQuestion();
        } else {
            this.finish();
        }
    }

    prev() {
        if (this.currentQ > 0) {
            // NOTE: Simple prev logic doesn't subtract score easily in this architecture 
            // without a history stack. For concise MVP, we just go back visually
            // but in a real app we'd need to pop the last score.
            // For now, let's just restart question render, user will overwrite score if we track history.
            // Improved Logic:
            alert("For accuracy, please continue forward. If you made a mistake, you can retake the assessment at the end.");
        }
    }

    finish() {
        // Find Top Type
        let maxScore = -1;
        let winner = 1;
        
        // Convert scores to array for sorting
        const sortedScores = Object.entries(this.scores)
            .sort(([,a], [,b]) => b - a);
            
        winner = parseInt(sortedScores[0][0]);
        maxScore = sortedScores[0][1];

        this.renderResults(winner, this.scores);
    }

    renderResults(winnerType, allScores) {
        const data = typeDescriptions[winnerType];
        
        // Calculate percentages relative to max possible score (3 questions * 5 points = 15)
        const MAX_POSSIBLE = 15;

        // Top 3 Matches
        const sortedScores = Object.entries(allScores)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 3);

        const html = `
            <div class="results-header">
                <div class="type-badge">Primary Match</div>
                <h2 class="result-title">${data.name}</h2>
                <div class="subtitle">${data.altNames}</div>
                <p style="margin-top: 16px; color: var(--neutral-mid);">${data.description}</p>
            </div>

            <div class="data-viz">
                <h4 style="margin-bottom: 12px; font-size: 0.9rem; text-transform: uppercase; color: var(--neutral-mid);">Likelihood Analysis</h4>
                ${sortedScores.map(([type, score]) => `
                    <div class="chart-row">
                        <div class="chart-label">T${type}</div>
                        <div class="chart-bar-container">
                            <div class="chart-bar ${parseInt(type) === winnerType ? 'top-result' : ''}" style="width: ${(score / MAX_POSSIBLE) * 100}%"></div>
                        </div>
                        <div style="font-size: 0.75rem; color: var(--neutral-mid);">${Math.round((score/MAX_POSSIBLE)*100)}%</div>
                    </div>
                `).join('')}
            </div>

            <div class="details-grid">
                <div class="detail-card">
                    <h3>At Your Best</h3>
                    <p>${data.atBest}</p>
                </div>
                <div class="detail-card">
                    <h3>Key Strengths</h3>
                    <ul>
                        ${data.strengths.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
                <div class="detail-card">
                    <h3>Growth Areas</h3>
                    <ul>
                        ${data.challenges.map(c => `<li>${c}</li>`).join('')}
                    </ul>
                </div>
            </div>

            <div class="citation">
                <p>Based on Riso-Hudson Enneagram Type Indicator (RHETI) methodology concepts.</p>
                <div style="margin-top:8px;">Source: Blose, T. M., et al. (2023). <em>The Enneagram in medical education.</em></div>
            </div>

            <div style="margin-top: 32px; text-align: center;">
                <button class="btn btn-outline" onclick="location.reload()">Restart Assessment</button>
            </div>
        `;

        this.dom.screens.results.innerHTML = html;
        this.switchScreen('results');
        this.dom.progress.style.width = '100%';
    }
}

// Initialize
const quiz = new Quiz();
</script>
</body>
</html>
